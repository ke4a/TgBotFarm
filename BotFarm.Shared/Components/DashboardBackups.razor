@using Microsoft.AspNetCore.Components.Web
@using BotFarm.Shared.Utilities
@using MudBlazor

@inherits DashboardComponentBase
@rendermode RenderMode.InteractiveServer

<MudPaper Elevation="3" Class="pa-4">
    <MudStack Row AlignItems="AlignItems.Center" Justify="Justify.SpaceBetween" Class="mb-4">
        <MudText Typo="Typo.h5">@Title</MudText>
        <MudStack Row Spacing="1">
            <MudTooltip Delay="500" Text="Refresh">
                <MudIconButton Color="Color.Info" Icon="@Icons.Material.Filled.Refresh" Disabled="@_loadingBackups" OnClick="() => LoadBackups(false)" />
            </MudTooltip>
            <MudTooltip Delay="500" Text="Create backup">
                <MudIconButton Color="Color.Success" Icon="@Icons.Material.Filled.Add" Disabled="@_workingBackup" OnClick="CreateBackup" />
            </MudTooltip>
        </MudStack>
    </MudStack>

    <MudTable Items="@_backups" Dense Hover="true" Loading="@_loadingBackups">
        <HeaderContent>
            <MudTh>#</MudTh>
            <MudTh>Name</MudTh>
            <MudTh>Date</MudTh>
            <MudTh>Size</MudTh>
            <MudTh>Actions</MudTh>
        </HeaderContent>
        <RowTemplate>
            <MudTd DataLabel="#">@(_backups.IndexOf(context) + 1)</MudTd>
            <MudTd DataLabel="Name">@context.Name</MudTd>
            <MudTd DataLabel="Date">@context.Date.ToLocalTime().ToString("dd MMM yyyy HH:mm:ss")</MudTd>
            <MudTd DataLabel="Size">@FormatUtils.FormatBytes(context.Size, 1)</MudTd>
            <MudTd DataLabel="Actions">
                <MudStack Row Spacing="1">
                    <MudTooltip Delay="500" Text="Download">
                        <MudIconButton Color="Color.Success" Icon="@Icons.Material.Filled.Download" OnClick="() => DownloadBackup(context.Name)" />
                    </MudTooltip>
                    <MudTooltip Delay="500" Text="Delete">
                        <MudIconButton Color="Color.Error" Icon="@Icons.Material.Filled.Delete" Disabled="@_workingBackup" OnClick="() => DeleteBackup(context.Name)" />
                    </MudTooltip>
                    <MudTooltip Delay="500" Text="Restore">
                        <MudIconButton Color="Color.Warning" Icon="@Icons.Material.Filled.Restore" Disabled="@_workingBackup" OnClick="() => RestoreBackup(context.Name)" />
                    </MudTooltip>
                </MudStack>
            </MudTd>
        </RowTemplate>
        <NoRecordsContent>
            <MudText>No backups found.</MudText>
        </NoRecordsContent>
    </MudTable>
</MudPaper>
