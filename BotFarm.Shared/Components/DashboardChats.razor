@using Microsoft.AspNetCore.Components.Web
@using MudBlazor

@inherits DashboardComponentBase
@rendermode RenderMode.InteractiveServer

<MudPaper Elevation="3" Class="pa-4">
    <MudStack Row AlignItems="AlignItems.Center" Justify="Justify.SpaceBetween" Class="mb-4">
        <MudText Typo="Typo.h5">@Title</MudText>
        <MudTooltip Delay="500" Text="Refresh">
            <MudIconButton Color="Color.Info" Icon="@Icons.Material.Filled.Refresh" Disabled="@_loadingChats" OnClick="() => LoadChatsAsync(false)" />
        </MudTooltip>
    </MudStack>

    <MudTable Items="@_chats" Dense Hover="true" Loading="@_loadingChats">
        <HeaderContent>
            <MudTh>#</MudTh>
            <MudTh>Name</MudTh>
            <MudTh>ID</MudTh>
            <MudTh>Actions</MudTh>
        </HeaderContent>
        <RowTemplate>
            <MudTd DataLabel="#">@(_chats.IndexOf(context) + 1)</MudTd>
            <MudTd DataLabel="Name">@GetChatName(context)</MudTd>
            <MudTd DataLabel="ID">@context.Id</MudTd>
            <MudTd DataLabel="Actions">
                <MudTooltip Delay="500" Text="Send message">
                    <MudIconButton Color="Color.Primary" Icon="@Icons.Material.Filled.Chat" OnClick="() => SendMessageAsync(context)" />
                </MudTooltip>
            </MudTd>
        </RowTemplate>
        <NoRecordsContent>
            <MudText>No chats found.</MudText>
        </NoRecordsContent>
    </MudTable>
</MudPaper>

<MudDialog @bind-Visible="_dialogVisible" Options="_dialogOptions">
    <TitleContent>
        <MudText Typo="Typo.h6">@_modalChatTitle</MudText>
    </TitleContent>
    <DialogContent>
        <div id="toolbar-container">
            <button class="ql-bold"></button>
            <button class="ql-italic"></button>
            <button class="ql-underline"></button>
            <button class="ql-strike"></button>
            <button class="ql-link"></button>
            <button id="spoiler-button" type="button">
                <svg viewBox="0 0 24 24">
                    @((MarkupString)@Icons.Material.Filled.BlurLinear)
                </svg>
            </button>
        </div>
        <div id="quill-editor" class="border rounded" style="height: 250px;"></div>
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="CancelSendMessage" Color="Color.Default">Cancel</MudButton>
        <MudButton OnClick="ConfirmSendMessage" Color="Color.Primary" Variant="Variant.Filled" StartIcon="@Icons.Material.Filled.Send">Send</MudButton>
    </DialogActions>
</MudDialog>
